<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬ - Ù…ØªØ±ÙƒÙ†Ù‡Ø§Ø´</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.12.2/lottie.min.js"></script>
    <style>
        :root {
            --primary: #1a237e;
            --primary-dark: #0d1440;
            --accent: #f59e0b;
            --accent-hover: #d97706;
            --text-dark: #0f172a;
            --text-light: #64748b;
            --white: #ffffff;
            --bg-light: #f8fafc;
            --success: #10b981;
            --danger: #ef4444;
            --shadow-sm: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            --glass: rgba(255, 255, 255, 0.82);
            --glass-border: rgba(255, 255, 255, 0.3);
        }

        body {
            font-family: 'Cairo', sans-serif;
            background: var(--bg-light);
            margin: 0;
            padding-bottom: 80px;
            color: var(--text-dark);
            line-height: 1.6;
        }

        /* --- Premium Animated Button --- */
        .btn-animated {
            position: relative;
            overflow: hidden;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .truck-overlay {
            position: fixed;
            inset: 0;
            background: rgba(15, 23, 42, 0.9);
            backdrop-filter: blur(10px);
            z-index: 5000;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            text-align: center;
        }

        .truck-animation-box {
            width: 300px;
            height: 300px;
        }

        .header {
            background: var(--glass);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border-bottom: 1px solid var(--glass-border);
            padding: 0.8rem 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: var(--shadow-sm);
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: 800;
            color: var(--primary);
            text-decoration: none;
        }

        .main-container {
            max-width: 1200px;
            margin: 30px auto;
            padding: 0 20px;
            display: grid;
            grid-template-columns: 1fr 1.2fr;
            gap: 40px;
        }

        /* Hero Image Section */
        .product-img-box {
            background: white;
            border-radius: 24px;
            padding: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            min-height: 500px;
            box-shadow: var(--shadow-md);
            border: 1px solid rgba(0, 0, 0, 0.03);
        }

        .product-img-box img {
            max-width: 100%;
            max-height: 440px;
            object-fit: contain;
            transition: transform 0.5s ease;
        }

        .product-img-box:hover img {
            transform: scale(1.05);
        }

        /* Details Section Hierarchy */
        .product-details-box {
            padding: 10px 0;
        }

        .sku {
            color: var(--text-light);
            font-size: 0.85rem;
            font-weight: 600;
            letter-spacing: 1px;
            margin-bottom: 8px;
            text-transform: uppercase;
        }

        h1 {
            color: var(--text-dark);
            font-size: 2.2rem;
            margin: 0 0 15px;
            font-weight: 900;
            line-height: 1.2;
        }

        .price-section {
            display: flex;
            align-items: baseline;
            gap: 12px;
            margin-bottom: 10px;
        }

        .price {
            font-size: 3rem;
            font-weight: 900;
            color: var(--primary);
            line-height: 1;
        }

        .price-note {
            color: var(--text-light);
            font-size: 1rem;
            font-weight: 600;
        }

        .rating-summary {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 25px;
            font-weight: 700;
            color: var(--text-dark);
        }

        .star-rating {
            color: #f59e0b;
            font-size: 1.1rem;
        }

        .vendors-count {
            color: var(--text-light);
            font-size: 0.9rem;
            background: #f1f5f9;
            padding: 4px 12px;
            border-radius: 20px;
        }

        /* AI Feature Card */
        .ai-fitment-card {
            background: linear-gradient(135deg, #f8faff 0%, #eff6ff 100%);
            border: 1px solid #bfdbfe;
            border-radius: 20px;
            padding: 25px;
            margin: 30px 0;
            box-shadow: 0 4px 20px rgba(59, 130, 246, 0.08);
            position: relative;
            overflow: hidden;
        }

        .ai-fitment-card::after {
            content: 'ğŸ§ ';
            position: absolute;
            top: -10px;
            left: -10px;
            font-size: 4rem;
            opacity: 0.05;
        }

        .ai-title {
            font-weight: 900;
            color: #1e3a8a;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.2rem;
        }

        .ai-input-group {
            position: relative;
            margin-bottom: 15px;
        }

        .ai-input {
            width: 100%;
            padding: 16px 20px 16px 50px;
            border-radius: 16px;
            border: 2px solid #dbeafe;
            font-family: 'Cairo';
            font-size: 1rem;
            outline: none;
            transition: 0.3s;
            background: white;
        }

        .ai-input:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
        }

        .check-btn-ai {
            background: #2563eb;
            color: white;
            border: none;
            width: 100%;
            padding: 16px;
            border-radius: 16px;
            font-weight: 800;
            cursor: pointer;
            transition: 0.3s;
            font-size: 1.05rem;
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.2);
        }

        .check-btn-ai:hover {
            background: #1d4ed8;
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(37, 99, 235, 0.3);
        }

        /* Trust Section (Amazon Style) */
        .trust-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 30px 0;
        }

        .trust-card {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 16px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            transition: 0.3s;
        }

        .trust-card:hover {
            border-color: var(--success);
            box-shadow: var(--shadow-sm);
        }

        .trust-card h5 {
            margin: 0;
            font-weight: 800;
            color: var(--text-dark);
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.95rem;
        }

        .trust-card p {
            margin: 0;
            font-size: 0.8rem;
            color: var(--text-light);
            line-height: 1.4;
        }

        /* Merchant Cards */
        .merchants-list {
            margin-top: 40px;
        }

        .merchants-list h3 {
            font-size: 1.4rem;
            font-weight: 900;
            color: var(--primary);
            margin-bottom: 20px;
        }

        .merchant-card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            border: 1px solid rgba(0, 0, 0, 0.05);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.02);
            transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .merchant-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-md);
            border-color: var(--primary);
        }

        .merchant-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .merchant-name {
            font-size: 1.25rem;
            font-weight: 800;
            color: var(--text-dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .trusted-badge-v2 {
            background: #ecfdf5;
            color: #059669;
            font-size: 0.75rem;
            padding: 4px 10px;
            border-radius: 20px;
            font-weight: 700;
            border: 1px solid #10b98130;
        }

        .merchant-rating-v2 {
            display: flex;
            align-items: center;
            gap: 6px;
            color: #f59e0b;
            font-weight: 700;
            font-size: 0.9rem;
        }

        .merchant-meta-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
            background: #f8fafc;
            padding: 12px;
            border-radius: 12px;
        }

        .meta-item {
            font-size: 0.85rem;
            color: var(--text-light);
            font-weight: 600;
        }

        .meta-item b {
            color: var(--text-dark);
        }

        .merchant-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 15px;
            border-top: 1px solid #f1f5f9;
        }

        .merchant-price {
            font-size: 1.6rem;
            font-weight: 900;
            color: #166534;
        }

        .merchant-btns {
            display: flex;
            gap: 10px;
        }

        .buy-now-btn {
            background: var(--primary);
            color: white;
            padding: 12px 25px;
            border-radius: 12px;
            font-weight: 800;
            text-decoration: none;
            transition: 0.3s;
            border: none;
            cursor: pointer;
            font-family: inherit;
        }

        .whatsapp-btn-v2 {
            background: transparent;
            color: #25d366;
            border: 2px solid #25d366;
            padding: 10px 20px;
            border-radius: 12px;
            font-weight: 800;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: 0.3s;
        }

        .whatsapp-btn-v2:hover {
            background: #25d366;
            color: white;
        }

        /* Actions */
        .actions {
            margin-top: 30px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .expert-btn {
            flex: 1;
            border: 2px solid var(--primary);
            background: transparent;
            color: var(--primary);
            padding: 15px;
            border-radius: 12px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: 0.2s;
            font-size: 1rem;
        }

        .expert-btn:hover {
            background: #f0f4ff;
        }

        /* Smart Chat Widget */
        .chat-widget {
            position: fixed;
            bottom: 20px;
            left: 20px;
            width: 350px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            z-index: 9999;
            overflow: hidden;
            display: none;
            border: 1px solid #eee;
            flex-direction: column;
        }

        .chat-header {
            background: #128c7e;
            color: white;
            padding: 15px;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-body {
            height: 300px;
            padding: 15px;
            background: #efeae2;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .msg {
            padding: 10px 15px;
            border-radius: 15px;
            max-width: 80%;
            font-size: 0.9rem;
            position: relative;
        }

        .msg-bot {
            background: white;
            align-self: flex-start;
            border-top-left-radius: 0;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }

        .chat-footer {
            padding: 10px;
            background: #f0f0f0;
            display: flex;
            gap: 10px;
        }

        .chat-input {
            flex: 1;
            padding: 10px;
            border-radius: 20px;
            border: 1px solid #ddd;
            outline: none;
            font-family: 'Cairo';
        }

        .send-btn {
            background: #128c7e;
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        @media(max-width: 768px) {
            .main-container {
                grid-template-columns: 1fr;
            }

            .fit-form {
                grid-template-columns: 1fr;
            }

            .seller-card {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }

            .seller-price-box {
                width: 100%;
                display: flex;
                align-items: center;
                justify-content: space-between;
            }

            .buy-seller-btn {
                width: auto;
                margin: 0;
            }
        }
    </style>
</head>

<body>
    <div id="truckOverlay" class="truck-overlay">
        <div id="truckAnimation" class="truck-animation-box"></div>
        <h2 id="truckStatusText" class="text-2xl font-bold mt-4">Ø¬Ø§Ø±ÙŠ ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ù‚Ø·Ø¹Ø©... ğŸšš</h2>
    </div>
    <header class="header">
        <div class="nav-container">
            <a href="index.html" class="logo"
                style="color: var(--primary); font-size: 1.8rem; font-weight: 900; text-decoration: none;">Ù…ØªØ±ÙƒÙ†Ù‡Ø§Ø´</a>
            <div style="display: flex; align-items: center; gap: 2.5rem;">
                <a href="index.html"
                    style="color: var(--text-dark); text-decoration: none; font-weight: 700; font-size: 0.95rem;">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
                <a href="profile.html" onclick="handleAccountClick(event)"
                    style="color: var(--text-dark); text-decoration: none; font-weight: 700; font-size: 0.95rem;">ğŸ‘¤
                    Ø­Ø³Ø§Ø¨ÙŠ</a>
                <div class="cart-icon-container" onclick="window.location.href='profile.html#cart'"
                    style="cursor:pointer; position:relative;">
                    <span style="font-size: 1.4rem;">ğŸ›’</span>
                    <span id="cartBadge"
                        style="position:absolute; top:-8px; right:-10px; background:#ff4757; color:white; font-size:0.7rem; padding:2px 6px; border-radius:50%; display:none;">0</span>
                </div>
            </div>
        </div>
    </header>

    <div class="main-container">
        <!-- Image Section -->
        <div class="product-img-box">
            <img id="pImg" src="https://via.placeholder.com/600x500" alt="Product">
            <span
                style="position: absolute; top:25px; right:25px; background:var(--success); color:white; padding:8px 20px; border-radius:30px; font-size:0.85rem; font-weight:800; box-shadow: 0 4px 10px rgba(16, 185, 129, 0.3);">
                Ø£ØµÙ„ÙŠ 100% âœ¨
            </span>
        </div>

        <!-- Details & Actions Section -->
        <div class="product-details-box">
            <div class="sku" id="pSku">SKU: MRK-LOAD-ING</div>
            <h1 id="pName">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</h1>

            <div class="price-section">
                <div class="price" id="pPrice">-- Ø¬.Ù…</div>
                <div class="price-note">ÙŠØ¨Ø¯Ø£ Ù…Ù† Ù‡Ø°Ø§ Ø§Ù„Ø³Ø¹Ø±</div>
            </div>

            <div class="rating-summary">
                <div class="star-rating">â­â­â­â­â­ 4.9</div>
                <div class="vendors-count" id="pVenderCount">3 ØªØ¬Ø§Ø± Ù…ØªØ§Ø­ÙŠÙ†</div>
            </div>

            <!-- Auto Garage Compatibility -->
            <div id="garageBadge" class="garage-badge"
                style="display: none; align-items: center; gap: 12px; background: #f0fdf4; border: 1.5px solid #10b981; padding: 15px; border-radius: 16px; margin-bottom: 25px;">
                <div style="font-size: 1.8rem;">ğŸš—</div>
                <div>
                    <div style="font-weight: 900; font-size: 1rem; color: #065f46;" id="garageStatus">Ù…ØªÙˆØ§ÙÙ‚ Ù…Ø¹ Ø³ÙŠØ§Ø±ØªÙƒ
                    </div>
                    <div style="font-size: 0.85rem; color: #047857; font-weight: 600;" id="garageCarName">ØªÙˆÙŠÙˆØªØ§ ÙƒÙˆØ±ÙˆÙ„Ø§
                        2021</div>
                </div>
            </div>

            <!-- Premium AI Fitment Section -->
            <div class="ai-fitment-card">
                <div class="ai-title">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="2.5">
                        <path
                            d="M12 2a10 10 0 1 0 10 10H12V2zM12 12L2.69 7.11A10 10 0 0 1 12 2v10zM12 12l9.31 4.89A10 10 0 0 1 12 22V12z" />
                    </svg>
                    AI Fitment & Car Expert
                </div>
                <p style="font-size: 0.9rem; color: #475569; margin-bottom: 20px; font-weight: 600;">
                    Ø§Ø³Ø£Ù„ Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³ Ø¹Ø¨ÙˆØ¯ Ø¹Ù† Ø§Ù„ØªÙˆØ§ÙÙ‚ Ø£Ùˆ Ø£ÙŠ Ø³Ø¤Ø§Ù„ Ù…ÙŠÙƒØ§Ù†ÙŠÙƒÙŠ Ø¨Ø®ØµÙˆØµ Ù‡Ø°Ù‡ Ø§Ù„Ù‚Ø·Ø¹Ø©
                </p>
                <div class="ai-input-group">
                    <input type="text" id="userVehicleText" class="ai-input"
                        placeholder="Ù…Ø«Ù„Ø§Ù‹: Ù‡Ù„ ØªØ±ÙƒØ¨ Ø¹Ù„Ù‰ Ø§Ù„Ù†ØªØ±Ø§ 2018ØŸ">
                    <span
                        style="position: absolute; left: 18px; top: 50%; transform: translateY(-50%); font-size: 1.2rem;">ğŸ‘¨â€ğŸ”§</span>
                </div>
                <button class="check-btn-ai" onclick="checkFitAI()">Ø§ÙØ­Øµ Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</button>
                <div id="fitResult" class="fit-result" style="margin-top: 15px;"></div>
            </div>

            <!-- Trust Grid (Amazon Protection Style) -->
            <div class="trust-grid">
                <div class="trust-card">
                    <h5>ğŸ›¡ï¸ Ù†Ø¸Ø§Ù… Escrow Ø§Ù„Ø¢Ù…Ù†</h5>
                    <p>ÙÙ„ÙˆØ³Ùƒ Ù…Ø´ Ù‡ØªÙˆØµÙ„ Ù„Ù„ØªØ§Ø¬Ø± ØºÙŠØ± Ø¨Ø¹Ø¯ Ø§Ø³ØªÙ„Ø§Ù…Ùƒ ÙˆÙ…Ø¹Ø§ÙŠÙ†ØªÙƒ Ù„Ù„Ù‚Ø·Ø¹Ø© ØªÙ…Ø§Ù…Ø§Ù‹.</p>
                </div>
                <div class="trust-card">
                    <h5>ğŸ”„ Ø¶Ù…Ø§Ù† Ù„Ù…Ø¯Ø© 14 ÙŠÙˆÙ…</h5>
                    <p>Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ù…Ø¬Ø§Ù†ÙŠ 100% Ù„Ùˆ Ø§Ù„Ù‚Ø·Ø¹Ø© ÙÙŠÙ‡Ø§ Ø¹ÙŠØ¨ ØµÙ†Ø§Ø¹Ø© Ø£Ùˆ ØºÙŠØ± Ù…Ø·Ø§Ø¨Ù‚Ø©.</p>
                </div>
            </div>

            <!-- Detailed Merchants List -->
            <div class="merchants-list">
                <h3 id="compareTitle">Ù‚Ø§Ø±Ù† Ø¹Ø±ÙˆØ¶ Ø§Ù„ØªØ¬Ø§Ø±</h3>
                <div id="sellersContainer">
                    <!-- Dynamic Merchant Cards will be injected here -->
                    <div class="text-center py-10 opacity-50">Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø£ÙØ¶Ù„ Ø§Ù„Ø£Ø³Ø¹Ø§Ø±...</div>
                </div>
            </div>
        </div>
    </div>
    <div class="actions" style="margin-top: 20px; padding: 0 20px; max-width: 1200px; margin: 0 auto;">
        <button class="expert-btn" onclick="openChat()" style="width: 100%; padding: 18px; font-size: 1.1rem;">
            <svg width="24" height="24" fill="currentColor" viewBox="0 0 16 16">
                <path
                    d="M16 8c0 3.866-3.582 7-8 7a9.06 9.06 0 0 1-2.347-.306c-.584.234-1.953.109-2.888-.813C4.911 2.71 12.685 0 16 8zm-8 4.743A7.051 7.051 0 0 1 2.485 10.4c.664-.95 1.776-3.953 5.432-5.719C10.741 3.522 13 5.093 13 8c0 2.227-1.789 4.223-4.916 4.743z" />
            </svg>
            Ø§Ø³Ø£Ù„ Ù…Ù‡Ù†Ø¯Ø³ Ù…Ø®ØªØµ (ÙˆØ§ØªØ³Ø§Ø¨ Ù…Ø¨Ø§Ø´Ø±)
        </button>
    </div>
    </div>
    </div>

    <!-- Live Widget -->
    <div class="chat-widget" id="chatWidget">
        <div class="chat-header">
            <span>Ù…Ù‡Ù†Ø¯Ø³ Ù…ØªØ±ÙƒÙ†Ù‡Ø§Ø´ ğŸ‘·â€â™‚ï¸</span>
            <span onclick="document.getElementById('chatWidget').style.display='none'" style="cursor:pointer;">âœ–</span>
        </div>
        <div class="chat-body" id="chatBody">
            <div class="msg msg-bot">
                Ø£Ù‡Ù„Ø§Ù‹ Ø¨ÙŠÙƒ!
                Ø£Ù†Ø§ Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„. Ø¹Ø´Ø§Ù† Ø£Ø³Ø§Ø¹Ø¯Ùƒ ØµØ­ØŒ ÙŠØ§Ø±ÙŠØª ØªØ¨Ø¹ØªÙ„ÙŠ ØµÙˆØ±Ø© Ø§Ù„Ø±Ø®ØµØ© Ø£Ùˆ Ø±Ù‚Ù… Ø§Ù„Ø´Ø§Ø³ÙŠÙ‡ Ù‡Ù†Ø§ ÙˆÙ‡Ø±Ø¯ Ø¹Ù„ÙŠÙƒ ÙÙˆØ±Ø§Ù‹.
            </div>
        </div>
        <div class="chat-footer">
            <input type="text" id="chatInput" class="chat-input" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ..."
                onkeypress="if(event.key==='Enter') sendToWhatsApp()">
            <button class="send-btn" onclick="sendToWhatsApp()">â¤</button>
        </div>
    </div>

    <script>
        // 1. Data Setup from URL
        const urlParams = new URLSearchParams(window.location.search);
        const partName = urlParams.get('part') || "Ù…Ù†ØªØ¬ Ø¹Ø§Ù…";
        const imgUrl = urlParams.get('img') || "https://via.placeholder.com/500?text=AutoPart";
        const partPrice = urlParams.get('price') || "450";
        const partVendor = urlParams.get('vendor') || "Ù…ØªØ±ÙƒÙ†Ù‡Ø§Ø´";
        const partCondition = urlParams.get('condition') || "Ø¬Ø¯ÙŠØ¯";
        const partWarranty = urlParams.get('warranty') || "Ù„Ø§ ÙŠÙˆØ¬Ø¯";

        document.getElementById('pName').innerText = partName;
        document.getElementById('pImg').src = imgUrl;
        document.getElementById('pPrice').innerText = `${partPrice} Ø¬.Ù…`;

        // 2. Fetch Other Sellers (Dynamic Comparison)
        // 2. Fetch Other Sellers (Dynamic Comparison)
        async function fetchOtherSellers() {
            try {
                // In a real app, you'd fetch specific sellers for this product
                // For demo, we might simulated them or fetch a few products.
                // Assuming we get data structure like: { sellers: [...] }
                // Let's simulate a fetch for now if the API is simple
                const res = await fetch('/api/products');
                const products = await res.json();

                // For demonstration, map products to sellers
                const sellers = products.slice(0, 3).map(p => ({
                    sellerName: p.vendorName || "ØªØ§Ø¬Ø± Ù…Ø¹ØªÙ…Ø¯",
                    isTrusted: true,
                    rating: (4 + Math.random()).toFixed(1),
                    price: p.price,
                    location: "Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©",
                    shipping: "Ù…Ø¬Ø§Ù†ÙŠ",
                    warranty: p.warranty || "Ù„Ø§ ÙŠÙˆØ¬Ø¯"
                }));

                const sellersContainer = document.getElementById('sellersContainer');
                const compareTitle = document.getElementById('compareTitle');

                if (sellers.length > 0) {
                    compareTitle.innerText = `Ù‚Ø§Ø±Ù† Ø¹Ø±ÙˆØ¶ Ø§Ù„ØªØ¬Ø§Ø± (${sellers.length})`;
                    document.getElementById('pVenderCount').innerText = `${sellers.length} ØªØ¬Ø§Ø± Ù…ØªØ§Ø­ÙŠÙ†`;

                    sellersContainer.innerHTML = sellers.map(s => `
                        <div class="merchant-card">
                            <div class="merchant-header">
                                <div>
                                    <div class="merchant-name">
                                        ${s.sellerName} 
                                        ${s.isTrusted ? '<span class="trusted-badge-v2">Ù…ÙˆØ«ÙˆÙ‚ âœ…</span>' : ''}
                                    </div>
                                    <div class="merchant-rating-v2">
                                        â­ ${s.rating} <span style="color:#64748b; font-size:0.8rem;">(Ù…ØªÙˆÙØ± Ø­Ø§Ù„ÙŠØ§Ù‹)</span>
                                    </div>
                                </div>
                                <div class="merchant-price">${s.price.toLocaleString()} Ø¬.Ù…</div>
                            </div>
                            
                            <div class="merchant-meta-grid">
                                <div class="meta-item">ğŸ“ Ø§Ù„Ù…ÙˆÙ‚Ø¹: <b>${s.location}</b></div>
                                <div class="meta-item">ğŸ“ Ø§Ù„Ø­Ø§Ù„Ø©: <b>Ø¬Ø¯ÙŠØ¯</b></div>
                                <div class="meta-item">ğŸšš Ø§Ù„Ø´Ø­Ù†: <b>${s.shipping}</b></div>
                                <div class="meta-item">ğŸ›¡ï¸ Ø§Ù„Ø¶Ù…Ø§Ù†: <b>${s.warranty}</b></div>
                            </div>

                            <div class="merchant-footer">
                                <div class="merchant-btns">
                                    <button class="buy-now-btn btn-animated" onclick="addToCart(this, '${s.sellerName}', null, null, ${s.price})">
                                        <span class="btn-text">Ø´Ø±Ø§Ø¡ Ø§Ù„Ø¢Ù†</span>
                                        <div class="lottie-container"></div>
                                    </button>
                                    <a href="https://wa.me/201016487547?text=Ø§Ø³ØªÙØ³Ø§Ø± Ø¹Ù† ${encodeURIComponent(partName)} Ù…Ù† ØªØ§Ø¬Ø± ${encodeURIComponent(s.sellerName)}" 
                                       target="_blank" class="whatsapp-btn-v2">
                                        ÙˆØ§ØªØ³Ø§Ø¨ Ù…Ø¨Ø§Ø´Ø±
                                    </a>
                                </div>
                            </div>
                        </div>
                    `).join('');
                } else {
                    sellersContainer.innerHTML = '<div class="text-center py-10">Ø¹Ø°Ø±Ø§Ù‹ØŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªØ¬Ø§Ø± Ù…ØªØ§Ø­ÙŠÙ† Ù„Ù‡Ø°Ù‡ Ø§Ù„Ù‚Ø·Ø¹Ø© Ø­Ø§Ù„ÙŠØ§Ù‹.</div>';
                }
            } catch (err) {
                console.error('Failed to load other sellers:', err);
                document.getElementById('sellersContainer').innerHTML = '<div class="text-center py-10 opacity-50">ØªØ¹Ø°Ø± Ø¬Ù„Ø¨ Ø¹Ø±ÙˆØ¶ Ø§Ù„ØªØ¬Ø§Ø± Ø­Ø§Ù„ÙŠØ§Ù‹.</div>';
            }
        }

        fetchOtherSellers();

        // 3. AI Fitment Logic (Premium Master Mechanic)
        async function checkFitAI() {
            const userText = document.getElementById('userVehicleText').value;
            const resultBox = document.getElementById('fitResult');
            const productId = urlParams.get('id');

            if (!userText) { alert("Ù…Ù† ÙØ¶Ù„Ùƒ Ø§ÙƒØªØ¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ø±Ø¨ÙŠØªÙƒ Ø§Ù„Ø£ÙˆÙ„!"); return; }

            resultBox.style.display = 'block';
            resultBox.innerHTML = `
                <div style="display:flex; align-items:center; gap:12px; padding:10px;">
                    <div class="typing-indicator">
                        <span></span><span></span><span></span>
                    </div>
                    <span style="color:#6366f1; font-weight:600;">Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³ Ø¹Ø¨ÙˆØ¯ Ø¨ÙŠÙÙƒØ±...</span>
                </div>
            `;
            resultBox.className = "fit-result";
            resultBox.style.opacity = '1';

            try {
                const res = await fetch('/api/check-fitment', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ productId: productId, userText: userText })
                });

                const data = await res.json();
                const text = data.reason || data.error || 'Ø¹Ø°Ø±Ø§Ù‹ØŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ù…Ø§';

                if (data.status === 'success') {
                    resultBox.className = "fit-result fit-success";
                } else if (data.status === 'warning') {
                    resultBox.className = "fit-result";
                    resultBox.style.background = "rgba(255, 251, 235, 0.9)";
                    resultBox.style.color = "#92400e";
                    resultBox.style.border = "1.5px solid #fde68a";
                } else {
                    resultBox.className = "fit-result fit-error";
                }

                // Typing Effect Logic
                resultBox.innerHTML = '';
                let i = 0;
                resultBox.style.minHeight = '60px';

                function typeWriter() {
                    if (i < text.length) {
                        resultBox.innerHTML += text.charAt(i);
                        i++;
                        setTimeout(typeWriter, 30);
                    }
                }
                typeWriter();

            } catch (err) {
                console.error('Fitment API Error:', err);
                resultBox.innerHTML = 'âš ï¸ ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³ Ø¹Ø¨ÙˆØ¯. Ø­Ø§ÙˆÙ„ ØªØ§Ù†ÙŠ ÙƒÙ…Ø§Ù† Ø´ÙˆÙŠØ©.';
            }
        }

        // Add CSS for spinner and typing indicator
        const style = document.createElement('style');
        style.innerHTML = `
            @keyframes spin { to { transform: rotate(360deg); } }
            @keyframes bounce {
                0%, 80%, 100% { transform: translateY(0); }
                40% { transform: translateY(-5px); }
            }
            .typing-indicator {
                display: flex;
                align-items: center;
                gap: 4px;
            }
            .typing-indicator span {
                width: 8px;
                height: 8px;
                background-color: #6366f1;
                border-radius: 50%;
                animation: bounce 1.4s infinite ease-in-out;
            }
            .typing-indicator span:nth-child(2) { animation-delay: -0.32s; }
            .typing-indicator span:nth-child(3) { animation-delay: -0.16s; }
        `;
        document.head.appendChild(style);

        // 4. WhatsApp Bridge
        function openChat() { document.getElementById('chatWidget').style.display = 'flex'; }

        function sendToWhatsApp() {
            const msg = document.getElementById('chatInput').value;
            if (!msg) return;
            const phone = "201102233317";
            const text = `Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ…ØŒ Ø¨Ø³ØªÙØ³Ø± Ø¹Ù† Ø§Ù„Ù…Ù†ØªØ¬: (${partName}).\n Ø³Ø¤Ø§Ù„ÙŠ: ${msg} `;
            window.open(`https://wa.me/${phone}?text=${encodeURIComponent(text)}`, '_blank');
        }

        async function checkGarageCompatibility() {
            const badge = document.getElementById('garageBadge');
            const statusText = document.getElementById('garageStatus');
            const carNameText = document.getElementById('garageCarName');
            const icon = document.getElementById('garageIcon');

            try {
                // 1. Get Primary Car
                const res = await fetch('/api/user/garage');
                const garage = await res.json();
                const primaryCar = garage.find(c => c.isPrimary);

                if (!primaryCar) {
                    badge.style.display = 'none';
                    return;
                }

                badge.style.display = 'flex';
                carNameText.innerText = `${primaryCar.make} ${primaryCar.model} (${primaryCar.year})`;

                // 2. Auto Check with AI Fitment
                const fitRes = await fetch('/api/check-fitment', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        productId: urlParams.get('id'),
                        userText: `Ø¹Ø±Ø¨ÙŠØªÙŠ ${primaryCar.make} ${primaryCar.model} Ù…ÙˆØ¯ÙŠÙ„ ${primaryCar.year} Ù…ÙˆØªÙˆØ± ${primaryCar.engine}. Ù‡Ù„ Ø§Ù„Ù‚Ø·Ø¹Ø© Ø¯ÙŠ Ø¨ØªØ±ÙƒØ¨ Ø¹Ù„ÙŠÙ‡Ø§ØŸ`
                    })
                });

                const data = await fitRes.json();

                if (data.status === 'success') {
                    badge.classList.add('compatible');
                    statusText.innerText = 'Ù…ØªÙˆØ§ÙÙ‚ Ù…Ø¹ Ø³ÙŠØ§Ø±ØªÙƒ Ø§Ù„Ù…Ø³Ø¬Ù„Ø© âœ“';
                    statusText.style.color = '#065f46';
                    icon.innerText = 'âœ…';
                } else if (data.status === 'error') {
                    badge.classList.add('not-compatible');
                    statusText.innerText = 'Ù‚Ø¯ Ù„Ø§ ÙŠÙƒÙˆÙ† Ù…ØªÙˆØ§ÙÙ‚Ø§Ù‹ Ù…Ø¹ Ø³ÙŠØ§Ø±ØªÙƒ âš ï¸';
                    statusText.style.color = '#991b1b';
                    icon.innerText = 'âŒ';
                } else {
                    statusText.innerText = 'Ø±Ø§Ø¬Ø¹ Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³ Ø¹Ø¨ÙˆØ¯ Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„ØªÙˆØ§ÙÙ‚';
                }
            } catch (err) {
                console.error('Garage Check Error:', err);
            }
        }

        checkGarageCompatibility();

        // --- Cart Logic ---
        function updateCartBadge() {
            const cart = JSON.parse(localStorage.getItem('cart') || '[]');
            const badge = document.getElementById('cartBadge');
            if (badge) {
                if (cart.length > 0) {
                    badge.innerText = cart.length;
                    badge.style.display = 'block';
                } else {
                    badge.style.display = 'none';
                }
            }
        }

        let isProcessingAdd = false;

        async function addToCart(btn, sellerName, customId = null, customName = null, customPrice = null, customImg = null) {
            if (isProcessingAdd) return;
            isProcessingAdd = true;

            const productId = customId || urlParams.get('id');
            const name = customName || document.getElementById('pName').innerText;
            const price = customPrice || parseInt(document.getElementById('pPrice').innerText.replace(/[^\d]/g, ''));
            const image = customImg || document.getElementById('pImg').src;

            if (!productId || productId === 'null') {
                alert('âš ï¸ Ø¹Ø°Ø±Ø§Ù‹ØŒ Ù„Ù… Ù†ØªÙ…ÙƒÙ† Ù…Ù† ØªØ­Ø¯ÙŠØ¯ Ø±Ù‚Ù… Ø§Ù„Ù…Ù†ØªØ¬.');
                isProcessingAdd = false;
                return;
            }

            // 1. Show Truck Animation Overlay
            const overlay = document.getElementById('truckOverlay');
            const truckAnimBox = document.getElementById('truckAnimation');
            const statusText = document.getElementById('truckStatusText');

            overlay.style.display = 'flex';
            statusText.innerText = `Ø¬Ø§Ø±ÙŠ ØªØ¬Ù‡ÙŠØ² [${name}]... ğŸšš`;

            truckAnimBox.innerHTML = ''; // Clear previous
            const anim = lottie.loadAnimation({
                container: truckAnimBox,
                renderer: 'svg', loop: true, autoplay: true,
                path: 'https://assets1.lottiefiles.com/packages/lf20_jpxsS6.json'
            });

            // 2. Simulate Processing
            setTimeout(async () => {
                let cart = JSON.parse(localStorage.getItem('cart') || '[]');
                cart.push({ productId, _id: productId, name, price, image, seller: sellerName || "Ù…ØªØ±ÙƒÙ†Ù‡Ø§Ø´", quantity: 1 });
                localStorage.setItem('cart', JSON.stringify(cart));
                updateCartBadge();

                // 3. Show Success in Overlay
                statusText.innerText = 'âœ… ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø¨Ù†Ø¬Ø§Ø­!';
                statusText.style.color = '#10b981';

                setTimeout(() => {
                    overlay.style.display = 'none';
                    anim.destroy();
                    isProcessingAdd = false;
                    statusText.style.color = 'white';
                }, 1500);
            }, 2500);
        }

        // Initialize UI
        document.addEventListener('DOMContentLoaded', () => {
            updateCartBadge();
            checkLoginStatus();
        });

        async function checkLoginStatus() {
            try {
                const res = await fetch('/auth/login/success');
                const data = await res.json();
                window.currentUser = data.success ? data.user : null;
            } catch (err) { }
        }

        function handleAccountClick(e) {
            if (!window.currentUser) {
                e.preventDefault();
                alert('ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹ Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø­Ø³Ø§Ø¨Ùƒ.');
                window.location.href = 'index.html';
            }
        }
    </script>
</body>

</html>
